{"ast":null,"code":"/*\r\nconst mongoose = require('mongoose');\r\n\r\nconst URI = process.env.MONGODB_URI ? process.env.MONGODB_URI : 'mongodb::localhost:27017/apimovie';\r\n\r\nmongoose.connect(URI, {\r\n  useNewUrlParser: true,\r\n  useCreateIndex: true\r\n})\r\n\r\nconst connection = mongoose.connection;\r\n\r\nconnection.once('open', () => {\r\n  console.log(\"DB is connected\");\r\n})\r\n*/\n\n/*\r\nconst { MongoClient } = require('mongodb');\r\nconst client = new MongoClient(process.env.MONGO_URI || 'mongodb://db');\r\n\r\nconst handler = async event => {\r\n  let data = [];\r\n  try {\r\n    switch (event.httpMethod) {\r\n      case 'GET':\r\n        data = await getComments(event.queryStringParameters.tvId);\r\n        break;\r\n      case 'POST':\r\n        insertComment(JSON.parse(event.body));\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n    return {\r\n      statusCode: 200,\r\n      body: JSON.stringify(data),\r\n    };\r\n  } catch (error) {\r\n    return { statusCode: 500, body: error.toString() };\r\n  }\r\n};\r\n\r\nasync function insertComment(comment) {\r\n  await connect(collection => {\r\n    collection.insertOne(comment);\r\n  });\r\n}\r\n\r\nasync function getComments(tvId) {\r\n  let data = [];\r\n  await connect(async collection => {\r\n    collection.find({ tvId: tvId }).forEach(comment => data.push(comment));\r\n  });\r\n\r\n  return data;\r\n}\r\n\r\nasync function connect(cb) {\r\n  try {\r\n    await client.connect();\r\n    let collection = await client.db('movieapi').collection('comments');\r\n    cb(collection);\r\n  } finally {\r\n    await client.close();\r\n  }\r\n}\r\n\r\nmodule.exports = { handler };\r\n*/","map":{"version":3,"sources":["C:/workspace-bilal/servidor/tema7/Practica_APIs_BILAL/react-moviedbapi/src/comments/comments.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sourcesContent":["/*\r\nconst mongoose = require('mongoose');\r\n\r\nconst URI = process.env.MONGODB_URI ? process.env.MONGODB_URI : 'mongodb::localhost:27017/apimovie';\r\n\r\nmongoose.connect(URI, {\r\n  useNewUrlParser: true,\r\n  useCreateIndex: true\r\n})\r\n\r\nconst connection = mongoose.connection;\r\n\r\nconnection.once('open', () => {\r\n  console.log(\"DB is connected\");\r\n})\r\n*/\r\n\r\n/*\r\nconst { MongoClient } = require('mongodb');\r\nconst client = new MongoClient(process.env.MONGO_URI || 'mongodb://db');\r\n\r\nconst handler = async event => {\r\n  let data = [];\r\n  try {\r\n    switch (event.httpMethod) {\r\n      case 'GET':\r\n        data = await getComments(event.queryStringParameters.tvId);\r\n        break;\r\n      case 'POST':\r\n        insertComment(JSON.parse(event.body));\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n    return {\r\n      statusCode: 200,\r\n      body: JSON.stringify(data),\r\n    };\r\n  } catch (error) {\r\n    return { statusCode: 500, body: error.toString() };\r\n  }\r\n};\r\n\r\nasync function insertComment(comment) {\r\n  await connect(collection => {\r\n    collection.insertOne(comment);\r\n  });\r\n}\r\n\r\nasync function getComments(tvId) {\r\n  let data = [];\r\n  await connect(async collection => {\r\n    collection.find({ tvId: tvId }).forEach(comment => data.push(comment));\r\n  });\r\n\r\n  return data;\r\n}\r\n\r\nasync function connect(cb) {\r\n  try {\r\n    await client.connect();\r\n    let collection = await client.db('movieapi').collection('comments');\r\n    cb(collection);\r\n  } finally {\r\n    await client.close();\r\n  }\r\n}\r\n\r\nmodule.exports = { handler };\r\n*/"]},"metadata":{},"sourceType":"module"}